<!DOCTYPE html>
<html>
	<head>
    	<meta charset="utf-8">
    	<meta name="viewport" content="width=device-width">
		<style>
			:root {
				--bi_h : -288px;
				--bi_w : 32px;
			}
			body {
				overflow : hidden;
			}
			.ts_im {
				position : absolute;
				height : 200vh;
				width : var(--width,200vw);
				left : 0%;
				top : 0%;
				animation : v_scroll 20s infinite linear;
			}
			@keyframes v_scroll {
				0% {
					transform : translate(var(--start_x,0%), var(--start_y,-5vh));
				}
				100% {
					transform : translate(var(--end_x,0%), var(--end_y,-100vh));
				}
			}
			#title_img {
				position : absolute;
				width : 40vw;
				left : 30%;
        		top : 40%;
				z-index : 1;
			}
			#block_holder {
				overflow : hidden;
			}
		</style>
	</head>
	<body style="background-color: #222222;">
		<audio id="music" src="audios/titlescreenmusic.mp3" loop></audio>
		
		<div class="ts_im" style="--start_x:0%;--end_x:0%;--start_y:0%;--end_y:var(--bi_h);background : url(sprites/wall_1.png) repeat;" hidden></div>
		<div class="ts_im" style="--start_x:0%;--end_x:0%;--start_y:0%;--end_y:var(--bi_h);background : url(sprites/wall_2.png) repeat;" hidden></div>
		<img src="sprites/titlescreen.png" id="title_img">
		<div id="title_cover" style="background:black;width:100vw;height:100vh;position:absolute;left:0px;top:0px;z-index:5;"></div>
		<script src="messages/common_messages.js"></script>
		<script>
			function spec_mess (m) {
				if (m === "start_music") {
					start_music();
				} else if (m === "close") {
					close();
				}
			}
			let music_loaded = false;
			function close (e) {
				console.log("close", music_loaded);
				// doesn't close if the music isn't loaded, this is because of a glitch where if the music isn't loaded before the title screen is closed then it won't ever stop playing
				if (!music_loaded) {
					return;
				}
				// hides itself and stops the music
				window.parent.document.getElementById("title_screen").hidden = true;
				document.getElementById("music").pause();
				// focuses the cursor on the text input
				window.parent.document.getElementById("text_input").focus();
			}
			// sets up the event listener
			document.addEventListener("keydown", close);
			// picks the background
			const index = 1 + Math.round(Math.random());
			// starts the title screen music
			function start_music () {
				// only starts if it is fully loaded
				if (!window.parent.document.getElementById("loading_screen").hidden) {
					return;
				}
				document.getElementById("music").play();
				document.getElementById("title_cover").hidden = true;
			}
			// sets up the event listener
			document.getElementById("music").addEventListener("canplaythrough",function () {start_music();music_loaded=true});
			// shows the correct background
			document.body.children[index].hidden = false;
			// sends the init message
			send("O:TS,R:IN,M:init");
			// tells the loading screen which background to display
			send("O:TS,R:LS,M:index="+index.toString());
			// tells the main window when the title screen has finished loading
			window.addEventListener("load",function (e) {send("O:TS,R:IN,M:lfin")});
		</script>
	</body>
</html>